<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Welcome To Windows 12</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;user-select:none}
  html,body{height:100%;width:100%;overflow:hidden;background:#111}
  body.locked{overflow:hidden}
  body.locked .window,body.locked .taskbar,body.locked .start-menu,body.locked .desktop{visibility:hidden}
  .wallpaper{position:absolute;inset:0;background:url("WALLPEPPA.jpeg") center/cover no-repeat;z-index:0}
  .desktop{position:absolute;inset:0;z-index:10;pointer-events:auto;padding:32px}
  .desktop-inner{position:absolute;inset:0}
  .icon{position:absolute;width:96px;height:110px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:8px;cursor:grab;color:#e9f0ff;touch-action:none;transition:box-shadow .14s,transform .12s}
  .icon .ico{width:64px;height:64px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.06);font-size:28px}
  .icon .label{font-size:13px;text-align:center;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.45);max-width:86px;word-wrap:break-word}
  .icon.selected .ico{outline:2px solid rgba(255,255,255,.18);box-shadow:0 6px 20px rgba(0,0,0,.45)}
  .icon.selected .label{background:rgba(0,0,0,.45);padding:2px 6px;border-radius:6px;color:#fff;font-weight:600}
  .icon.dragging{opacity:.9;transform:scale(1.02);cursor:grabbing;z-index:1200;box-shadow:0 30px 80px rgba(2,6,23,.6)}
  .ctx-menu{position:fixed;min-width:160px;background:#fff;color:#0b253a;border-radius:8px;box-shadow:0 12px 40px rgba(2,6,23,.45);border:1px solid rgba(0,0,0,.06);z-index:1200;display:none;padding:6px;font-size:14px}
  .ctx-menu button{display:block;width:100%;text-align:left;padding:8px 10px;border:0;background:transparent;cursor:pointer;border-radius:6px}
  .ctx-menu button:hover{background:rgba(0,0,0,.04)}
  #loginScreen{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:url("WALLPEPPA.jpeg") center/cover no-repeat;background-size:cover}
  #loginCard{width:420px;max-width:92%;padding:28px;border-radius:12px;background:rgba(2,6,23,.48);box-shadow:0 24px 80px rgba(2,6,23,.7);border:1px solid rgba(255,255,255,.04);display:flex;flex-direction:column;align-items:center;gap:14px;color:#fff}
  .login-photo{width:120px;height:120px;border-radius:999px;overflow:hidden;border:4px solid rgba(255,255,255,.08);display:grid;place-items:center;background:#eee}
  .login-photo img{width:100%;height:100%;object-fit:cover}
  .login-name{font-size:20px;font-weight:700;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.45)}
  .pin-input{width:100%;max-width:360px;display:flex;flex-direction:column;gap:8px}
  .pin-input input{width:100%;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.35);color:#fff;font-size:16px;outline:none;text-align:center}
  .pin-actions{display:flex;gap:8px;width:100%;justify-content:center;margin-top:6px}
  .btn-ghost{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,.08);color:#fff;cursor:pointer}
  .btn-primary{padding:8px 12px;border-radius:8px;background:linear-gradient(180deg,#0b84ff,#0463d6);border:0;color:#fff;cursor:pointer}
  .login-hint{font-size:12px;color:rgba(255,255,255,.75);margin-top:6px}
  .taskbar{position:absolute;left:0;right:0;bottom:0;height:55px;background:rgba(255,255,255,.2);backdrop-filter:blur(16px);display:flex;align-items:center;padding:6px 12px;gap:12px;z-index:50}
  .taskbar-left{display:flex;gap:8px;align-items:center}
  .taskbar-icon{width:44px;height:44px;border-radius:8px;display:grid;place-items:center;background:rgba(255,255,255,.12);cursor:pointer}
  .taskbar-icon.active{box-shadow:0 8px 18px rgba(0,0,0,.5);background:rgba(255,255,255,.22)}
  .taskbar-pin{width:40px;height:40px;border-radius:8px;display:grid;place-items:center;background:rgba(0,0,0,.05);cursor:pointer;margin-left:6px}
  .window{position:absolute;left:80px;top:60px;width:900px;height:600px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.98),#fbfbff);box-shadow:0 20px 60px rgba(2,6,23,.7);border:1px solid rgba(0,0,0,.06);display:flex;flex-direction:column;z-index:40}
  .titlebar{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:linear-gradient(180deg,rgba(255,255,255,.98),#f7f7fb);cursor:grab}
  .title-left{display:flex;align-items:center;gap:12px}
  .badge{width:36px;height:36px;border-radius:8px;display:grid;place-items:center;background:linear-gradient(180deg,#f59e0b,#f97316);color:white;font-weight:700}
  .win-controls{display:flex;gap:8px;align-items:center}
  .win-btn{width:36px;height:30px;border-radius:6px;display:grid;place-items:center;cursor:pointer}
  .content{flex:1;display:flex;height:100%;min-height:0}
  .sidebar{width:320px;border-right:1px solid rgba(0,0,0,.04);display:flex;flex-direction:column;background:linear-gradient(180deg,#fff,#fbfbff)}
  .sb-top{padding:12px;border-bottom:1px solid rgba(0,0,0,.03);display:flex;flex-direction:column;gap:8px}
  .sb-actions{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.03);cursor:pointer;font-size:13px}
  .btn.primary{background:#007aff;color:white}
  .search{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,.04);background:#fafafa}
  .search input{border:0;outline:none;background:transparent;font-size:14px;width:100%}
  .note-list{overflow:auto;flex:1;padding:6px}
  .note-item{display:flex;flex-direction:column;padding:10px;border-radius:8px;cursor:pointer;gap:6px}
  .note-item:hover{background:rgba(0,0,0,.03)}
  .note-item.active{background:linear-gradient(180deg,#f1f9ff,#e6f4ff);box-shadow:inset 0 0 0 1px rgba(0,122,255,.08)}
  .note-title{font-weight:600;color:#082a4a}
  .note-snippet{font-size:13px;color:#3b556f;opacity:.85}
  .note-meta{font-size:12px;color:#556b88}
  .editor{flex:1;display:flex;flex-direction:column;min-width:0}
  .editor-toolbar{height:56px;display:flex;align-items:center;gap:8px;padding:8px 12px;border-bottom:1px solid rgba(0,0,0,.04);background:linear-gradient(180deg,#fff,#fbfbff)}
  .editor-body{flex:1;overflow:auto;padding:18px}
  .note-title-input{font-size:20px;font-weight:700;border:0;outline:none;padding:6px 0;width:100%;background:transparent}
  .note-textarea{width:100%;height:calc(100% - 46px);border:0;outline:none;resize:none;padding:12px 6px;font-size:15px;line-height:1.5;background:transparent;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  .editor-locked{filter:blur(4px)}
  .resizer{position:absolute;right:10px;bottom:10px;width:12px;height:12px;cursor:se-resize}
  .window.fullscreen{left:0 !important;top:0 !important;width:100vw !important;height:calc(100vh - 55px) !important;border-radius:0 !important;overflow:hidden !important}
  .window.fullscreen .resizer{display:none !important}
  .start-menu{position:absolute;bottom:62px;left:12px;width:880px;height:520px;background:linear-gradient(180deg,#ffffffee,#f5f7fb);border-radius:12px;box-shadow:0 30px 80px rgba(2,6,23,.6);border:1px solid rgba(0,0,0,.06);display:none;z-index:200;overflow:hidden;color:#0b253a;backdrop-filter:blur(6px)}
  .start-inner{Display:flex;height:100%}
  .start-left{width:260px;border-right:1px solid rgba(0,0,0,.04);background:linear-gradient(180deg,#f7fafc,#fff);padding:16px;display:flex;flex-direction:column;gap:12px}
  .start-search{display:flex;align-items:center;gap:8px;background:#fff;border-radius:8px;padding:8px;border:1px solid rgba(0,0,0,.04)}
  .start-search input{border:0;outline:none;width:100%;font-size:14px;background:transparent}
  .start-profile{display:flex;align-items:center;gap:10px;padding-top:6px}
  .profile-pic{width:40px;height:40px;border-radius:999px;background:linear-gradient(180deg,#e6eefb,#d9e6ff);display:grid;place-items:center;font-weight:700;color:#11477a;overflow:hidden}
  .profile-pic img{width:100%;height:100%;object-fit:cover;border-radius:999px}
  .app-list{flex:1;overflow:auto;padding-right:6px;margin-top:6px}
  .app-list .app-item{display:flex;align-items:center;gap:12px;padding:8px 6px;border-radius:6px;cursor:pointer;color:#123145;font-size:14px}
  .app-list .app-item:hover{background:rgba(0,0,0,.03)}
  .start-right{flex:1;padding:18px;display:flex;flex-direction:column;gap:12px}
  .tiles-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .tile{height:76px;border-radius:8px;display:flex;flex-direction:column;align-items:flex-start;justify-content:center;padding:10px;color:white;font-weight:600;box-shadow:inset 0 -30px 40px rgba(0,0,0,.06)}
  .t-icon{width:34px;height:34px;border-radius:8px;display:grid;place-items:center;margin-bottom:6px;background:rgba(255,255,255,.12)}
  .tile.office{background:linear-gradient(180deg,#2b6dde,#1f4fd3)}
  .tile.edge{background:linear-gradient(180deg,#0ea5a5,#028f8f)}
  .tile.photos{background:linear-gradient(180deg,#6b21a8,#8b5cf6)}
  .tile.netflix{background:linear-gradient(180deg,#111827,#ef4444)}
  .tile.store{background:linear-gradient(180deg,#0ea5a5,#1fb5b5);color:#042f2f}
  .tile.spotify{background:linear-gradient(180deg,#1db954,#1db954)}
  .tile.store{background:linear-gradient(180deg,#0ea5a5,#1fb5b5);color:#042f2f}
  .tile.spotify{background:linear-gradient(180deg,#1db954,#1db954)}
  .start-footer{display:flex;justify-content:space-between;font-size:12px;color:#4b657a;padding-top:6px}
  /* Settings-specific */
  .settings-sidebar{width:260px;border-right:1px solid rgba(0,0,0,.04);background:linear-gradient(180deg,#fff,#fbfbff);padding:12px;display:flex;flex-direction:column;gap:8px}
  .settings-content{flex:1;padding:16px;overflow:auto}
  .preset-grid{display:flex;gap:10px;flex-wrap:wrap}
  .preset-thumb{width:120px;height:80px;border-radius:8px;background:#eee;background-size:cover;background-position:center;box-shadow:inset 0 0 0 1px rgba(0,0,0,.04);cursor:pointer;display:grid;place-items:center;font-size:12px;color:#fff}
  .preview-box{width:100%;height:160px;border-radius:8px;border:1px solid rgba(0,0,0,.06);background-size:cover;background-position:center;overflow:hidden;margin-bottom:10px}

  /* IMAGE ICON STYLES (for inserted settings image) */
  .icon .ico img{width:36px;height:36px;object-fit:contain;border-radius:8px;display:block}
  .t-icon img{width:22px;height:22px;object-fit:contain;display:block;border-radius:6px}
  .badge img{width:20px;height:20px;object-fit:contain;display:block;border-radius:6px}

  @media (max-width:1000px){.start-menu{left:8px;right:8px;width:auto}.tiles-grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:960px){.window{left:8px;top:8px;right:8px;width:calc(100% - 16px);height:calc(100% - 80px)}.sidebar{width:260px}}
</style>
</head>
<body class="locked">
<div id="ctxMenu" class="ctx-menu" role="menu" aria-hidden="true">
  <button id="ctxOpen">Open</button>
  <button id="ctxPin">Pin to taskbar</button>
</div>

<div id="loginScreen" role="dialog" aria-modal="true" aria-label="Sign in">
  <div id="loginCard" role="document" aria-labelledby="loginName">
    <div class="login-photo"><img src="profile.png" alt="Profile photo" /></div>
    <div style="text-align:center">
      <div id="loginName" class="login-name">1ScratchfromScratch</div>
      <div class="login-sub">Enter your PIN to sign in</div>
    </div>
    <div class="pin-input">
      <input id="pinInput" type="password" inputmode="numeric" placeholder="PIN" aria-label="PIN" autocomplete="off" />
      <div class="pin-actions">
        <button id="pinCancel" class="btn-ghost" type="button">Cancel</button>
        <button id="pinSubmit" class="btn-primary" type="button">Sign in</button>
      </div>
      <div class="login-hint">I am number #1</div>
    </div>
  </div>
</div>

<div class="wallpaper" aria-hidden="true"></div>

<div class="desktop" role="application" aria-label="Desktop icons">
  <div class="desktop-inner" id="desktopInner" tabindex="0"></div>
</div>

<div id="startMenu" class="start-menu" role="menu" aria-hidden="true" aria-label="Start menu">
  <div class="start-inner">
    <div class="start-left">
      <div class="start-search" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.6"><path d="M21 21l-4.35-4.35" stroke="#234" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#234" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="startSearch" placeholder="Type here to search" aria-label="Search" />
      </div>
      <div class="start-profile">
        <div class="profile-pic"><img src="profile.png" alt="Profile picture" /></div>
        <div><div style="font-weight:700">1ScratchfromScratch</div><div style="font-size:12px;color:#4b657a">Local Account</div></div>
      </div>
      <div class="app-list" id="startAppList" tabindex="0" aria-label="Pinned and installed apps">
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#c7e0ff,#a6c8ff);display:inline-grid;place-items:center">üì¶</span> 3D Viewer</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#d4f1d4,#a8e6a8);display:inline-grid;place-items:center">üßÆ</span> Calculator</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#f9e7d6,#ffd8b6);display:inline-grid;place-items:center">üìÖ</span> Calendar</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#f0f6ff,#d7e9ff);display:inline-grid;place-items:center">üì∑</span> Camera</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#fff3d6,#ffe1a8);display:inline-grid;place-items:center">üïí</span> Clock</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#e6f3ff,#cfe6ff);display:inline-grid;place-items:center">üîç</span> Cortana</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#fbe6ff,#f3c8ff);display:inline-grid;place-items:center">‚úâÔ∏è</span> Mail</div>
        <div class="app-item"><span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#e6f7ff,#cfefff);display:inline-grid;place-items:center">üéß</span> Groove Music</div>
        <!-- Settings app item: use settings.png -->
        <div class="app-item">
          <span style="width:28px;height:28;border-radius:6px;background:linear-gradient(180deg,#ffdbe6,#ffbfd6);display:inline-grid;place-items:center">
            <img src="settings.png" alt="Settings" style="width:20px;height:20px;object-fit:contain;border-radius:4px;display:block">
          </span>
          Settings
        </div>
      </div>
      <div style="padding-top:8px;"><div class="app-item" style="font-size:13px;color:#556b88;justify-content:flex-start">Power</div></div>
    </div>

    <div class="start-right">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:700;font-size:16px">Productivity</div>
        <div style="font-size:13px;color:#4b657a">Pinned</div>
      </div>

      <div class="tiles-grid" role="grid" aria-label="Pinned apps">
        <div class="tile office" role="gridcell" title="Outlook"><div class="t-icon">üìß</div><div>Outlook</div></div>
        <div class="tile office" role="gridcell" title="Word"><div class="t-icon">W</div><div>Word</div></div>
        <div class="tile office" role="gridcell" title="Excel"><div class="t-icon">X</div><div>Excel</div></div>
        <div class="tile edge" role="gridcell" title="OneDrive"><div class="t-icon">‚òÅÔ∏è</div><div>OneDrive</div></div>
        <div class="tile office" role="gridcell" title="PowerPoint"><div class="t-icon">P</div><div>PowerPoint</div></div>
        <div class="tile" role="gridcell" title="Microsoft To Do" style="background:linear-gradient(180deg,#4b5563,#56607a)"><div class="t-icon">‚úì</div><div>To Do</div></div>
        <div class="tile" role="gridcell" title="Office" style="background:linear-gradient(180deg,#d97706,#f59e0b)"><div class="t-icon">‚åò</div><div>Office</div></div>
        <div class="tile" role="gridcell" title="Skype" style="background:linear-gradient(180deg,#60a5fa,#3b82f6)"><div class="t-icon">S</div><div>Skype</div></div>
        <div class="tile photos" role="gridcell" title="Photos"><div class="t-icon">üñºÔ∏è</div><div>Photos</div></div>
        <div class="tile store" role="gridcell" title="Microsoft Store"><div class="t-icon">üè¨</div><div>Microsoft Store</div></div>
        <div class="tile spotify" role="gridcell" title="Spotify"><div class="t-icon">‚ô™</div><div>Spotify</div></div>
        <div class="tile netflix" role="gridcell" title="Disney+"><div class="t-icon">‚òÖ</div><div>Disney+</div></div>

        <!-- Settings tile: use settings.png -->
        <div class="tile" role="gridcell" title="Settings" id="tile-settings" style="background:linear-gradient(180deg,#8b5cf6,#6b21a8)">
          <div class="t-icon">
            <img src="settings.png" alt="Settings" />
          </div>
          <div>Settings</div>
        </div>
      </div>

      <div class="start-footer"><div>All apps</div><div>Quick access</div></div>
    </div>
  </div>
</div>

<div class="taskbar" role="toolbar" aria-label="Taskbar">
  <div class="taskbar-left">
    <div id="startBtn" class="taskbar-icon" title="Start" aria-haspopup="true" aria-expanded="false" role="button"><img src="logo.png" width="26" alt="Start"></div>
    <div id="taskbarPins" style="display:flex;gap:8px;align-items:center;"></div>
    <div id="tb-notes" class="taskbar-icon active" title="Notes">üìù</div>
  </div>
  <div style="margin-left:auto;color:#fff;font-size:13px" id="clock">--:--</div>
</div>

<div id="win-notes" class="window" role="dialog" aria-label="Notes" style="display:none">
  <div class="titlebar" data-drag="true">
    <div class="title-left"><div class="badge">N</div><div><div style="font-weight:700">Notes</div><div style="font-size:12px;color:#3b556f">Windows 12 notes system</div></div></div>
    <div class="win-controls"><div id="notes-min" class="win-btn" title="Minimize">‚Äî</div><div id="notes-full" class="win-btn" title="Fullscreen">‚ñ¢</div><div id="notes-close" class="win-btn" title="Close">‚úï</div></div>
  </div>

  <div class="content">
    <div class="sidebar" aria-label="Notes list">
      <div class="sb-top">
        <div style="display:flex;align-items:center;justify-content:space-between;"><div style="font-weight:700">Winotes</div><div style="font-size:12px;color:#3b556f">Updated</div></div>
        <div style="display:flex;gap:8px;align-items:center"><div class="btn primary" id="btn-new" title="New Note">New</div><div class="btn" id="btn-delete" title="Delete Note">Delete</div><div style="flex:1"></div></div>
        <div class="search" style="margin-top:8px"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="#223" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#223" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg><input id="searchInput" placeholder="Search" /></div>
      </div>
      <div class="note-list" id="noteList" tabindex="0"></div>
    </div>

    <div class="editor" aria-label="Note editor">
      <div class="editor-toolbar"><div style="display:flex;align-items:center;gap:8px"><div class="btn" id="btn-lock" title="Lock (toggle)">üîí</div><div class="btn" id="btn-share" title="Share (stub)">üì§</div></div><div style="flex:1"></div><div style="font-size:13px;color:#345">Autosave</div></div>
      <div class="editor-body" id="editorBody">
        <div id="editorInner" style="width:100%;height:100%;display:flex;flex-direction:column;min-height:0">
          <input id="noteTitle" class="note-title-input" placeholder="Title" />
          <textarea id="noteText" class="note-textarea" placeholder="Start typing your note..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="resizer" id="notesResizer"></div>
</div>

<!-- Settings window -->
<div id="win-settings" class="window" role="dialog" aria-label="Settings" style="display:none">
  <div class="titlebar" data-drag="true">
    <!-- badge replaced with image -->
    <div class="title-left">
      <div class="badge">
        <img src="settings.png" alt="Settings">
      </div>
      <div>
        <div style="font-weight:700">Settings</div>
        <div style="font-size:12px;color:#3b556f">System & personalization</div>
      </div>
    </div>
    <div class="win-controls"><div id="settings-min" class="win-btn" title="Minimize">‚Äî</div><div id="settings-full" class="win-btn" title="Fullscreen">‚ñ¢</div><div id="settings-close" class="win-btn" title="Close">‚úï</div></div>
  </div>

  <div class="content">
    <div class="settings-sidebar" role="navigation" aria-label="Settings categories">
      <div style="font-weight:700">Settings</div>
      <div class="btn" id="settings-category-personal">Personalization</div>
      <div class="btn" id="settings-category-wall">Wallpaper</div>
      <div style="flex:1"></div>
      <div style="font-size:12px;color:#556b88">Settings are saved locally</div>
    </div>

    <div class="settings-content" id="settingsContent" aria-live="polite">
      <div style="font-weight:700;font-size:16px">Personalization</div>
      <div style="margin-top:12px" id="settingsMain">
        <div style="font-weight:600;margin-bottom:8px">Wallpaper</div>
        <div class="preview-box" id="wallPreview" aria-hidden="true"></div>

        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <label class="btn" for="wallFile" title="Upload an image" style="cursor:pointer">Upload image</label>
          <input id="wallFile" type="file" accept="image/*" style="display:none" />
          <input id="wallUrl" placeholder="Or paste an image URL here" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,.06)" />
          <button id="applyUrl" class="btn primary">Apply</button>
        </div>

        <div style="margin-bottom:10px">Presets</div>
        <div class="preset-grid" id="presetGrid">
          <!-- thumbnails will be filled by JS -->
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="resetWallpaper" class="btn">Reset to default</button>
          <div style="flex:1"></div>
          <button id="saveWallpaper" class="btn primary">Save</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  /* existing references */
  const loginScreen=document.getElementById('loginScreen'),pinInput=document.getElementById('pinInput'),pinSubmit=document.getElementById('pinSubmit'),pinCancel=document.getElementById('pinCancel');
  const desktopInner=document.getElementById('desktopInner'),ctxMenu=document.getElementById('ctxMenu'),ctxOpen=document.getElementById('ctxOpen'),ctxPin=document.getElementById('ctxPin');
  const taskbarPinsEl=document.getElementById('taskbarPins'),tbNotes=document.getElementById('tb-notes'),winNotes=document.getElementById('win-notes');
  const noteListEl=document.getElementById('noteList'),btnNew=document.getElementById('btn-new'),btnDelete=document.getElementById('btn-delete'),searchInput=document.getElementById('searchInput');
  const noteTitleEl=document.getElementById('noteTitle'),noteTextEl=document.getElementById('noteText'),notesResizer=document.getElementById('notesResizer');
  const notesMin=document.getElementById('notes-min'),notesClose=document.getElementById('notes-close'),notesFull=document.getElementById('notes-full'),clockEl=document.getElementById('clock');
  const btnLock=document.getElementById('btn-lock'),editorInner=document.getElementById('editorInner'),editorBody=document.getElementById('editorBody');
  const startBtn=document.getElementById('startBtn'),startMenu=document.getElementById('startMenu'),startSearch=document.getElementById('startSearch');
  const startAppList=document.getElementById('startAppList'),tileSettings=document.getElementById('tile-settings');

  /* settings elements */
  const winSettings = document.getElementById('win-settings');
  const settingsMin = document.getElementById('settings-min');
  const settingsFull = document.getElementById('settings-full');
  const settingsClose = document.getElementById('settings-close');
  const wallFile = document.getElementById('wallFile');
  const wallUrl = document.getElementById('wallUrl');
  const applyUrl = document.getElementById('applyUrl');
  const wallPreview = document.getElementById('wallPreview');
  const presetGrid = document.getElementById('presetGrid');
  const resetWallpaper = document.getElementById('resetWallpaper');
  const saveWallpaperBtn = document.getElementById('saveWallpaper');

  const STORAGE_KEY='notes_app_v1',DESKTOP_POS_KEY='desktop_positions_v1',PINNED_KEY='pinned_apps_v1';
  const WALLPAPER_KEY='wallpaper_v1';

  let notes=[],selectedId=null,filter='',locked=false;
  const defaultDesktopItems=[{id:'notes',title:'Notes',icon:'üìù',action:'open-notes'},{id:'recycle',title:'Recycle Bin',icon:'üóëÔ∏è',action:'noop'}];
  let desktopPositions={},desktopItems=JSON.parse(JSON.stringify(defaultDesktopItems)),pinnedApps=[];

  const CELL_W=96,CELL_H=110,PADDING=32,GAP_X=18,GAP_Y=0;

  /* Load persisted small state */
  function loadPersisted(){try{const pos=JSON.parse(localStorage.getItem(DESKTOP_POS_KEY)||'null');if(pos&&typeof pos==='object')desktopPositions=pos}catch(e){desktopPositions={}}try{pinnedApps=JSON.parse(localStorage.getItem(PINNED_KEY)||'null')||[]}catch(e){pinnedApps=[]}}
  loadPersisted();

  const REQUIRED_PIN='imthebest';

  function computeGridCols(){const rect=desktopInner.getBoundingClientRect();const availableWidth=Math.max(0,rect.width-(PADDING*2));const colWidth=CELL_W+GAP_X;return Math.max(1,Math.floor((availableWidth+GAP_X)/colWidth))}
  function gridPositionForIndex(i){const cols=computeGridCols();const col=i%cols;const row=Math.floor(i/cols);return{ x:PADDING+col*(CELL_W+GAP_X), y:PADDING+row*(CELL_H+GAP_Y)}}
  function snapToGrid(x,y){const rect=desktopInner.getBoundingClientRect();const cols=computeGridCols();const colWidth=CELL_W+GAP_X;const rowHeight=CELL_H+GAP_Y;let rx=x-rect.left-PADDING;let ry=y-rect.top-PADDING;let col=Math.round(rx/colWidth);let row=Math.round(ry/rowHeight);col=Math.max(0,Math.min(cols-1,col));const maxRows=Math.max(1,Math.floor((rect.height-PADDING*2+GAP_Y)/rowHeight));row=Math.max(0,Math.min(maxRows-1,row));return{ x:PADDING+col*colWidth, y:PADDING+row*rowHeight}}

  function renderDesktop(){
    if(!desktopInner) return;
    desktopInner.innerHTML='';
    desktopItems.forEach((it,idx)=>{
      const node=document.createElement('div');node.className='icon';node.setAttribute('data-id',it.id);node.setAttribute('tabindex','0');
      node.innerHTML=`<div class="ico" aria-hidden="true">${it.icon}</div><div class="label">${it.title}</div>`;
      const pos=desktopPositions[it.id]||gridPositionForIndex(idx);
      node.style.left=(pos.x)+'px';node.style.top=(pos.y)+'px';
      desktopInner.appendChild(node);

      let clickTimer=null;
      node.addEventListener('click',e=>{e.stopPropagation();clearSelections();node.classList.add('selected');if(clickTimer){clearTimeout(clickTimer);clickTimer=null;handleDesktopAction(it)}else{clickTimer=setTimeout(()=>{clearTimeout(clickTimer);clickTimer=null},300)}});

      node.addEventListener('keydown',e=>{if(e.key==='Enter')handleDesktopAction(it)});
      node.addEventListener('contextmenu',e=>{e.preventDefault();e.stopPropagation();showContextMenuFor(it,e.clientX,e.clientY)});

      let dragging=false,startX=0,startY=0,origLeft=0,origTop=0;
      function pointerDown(ev){
        if(isLocked()){focusPin();return}
        ev.preventDefault();
        dragging=true;node.classList.add('dragging');
        const p=ev.touches?ev.touches[0]:ev;
        startX=p.clientX;startY=p.clientY;
        const r=node.getBoundingClientRect();origLeft=r.left-desktopInner.getBoundingClientRect().left;origTop=r.top-desktopInner.getBoundingClientRect().top;
        node.style.zIndex=2000;
        window.addEventListener('pointermove',pointerMove);window.addEventListener('pointerup',pointerUp,{once:true});
        window.addEventListener('touchmove',pointerMove,{passive:false});window.addEventListener('touchend',pointerUp,{once:true});
      }
      function pointerMove(ev){
        if(!dragging) return;
        ev.preventDefault();
        const p=ev.touches?ev.touches[0]:ev;
        const dx=p.clientX-startX,dy=p.clientY-startY;
        const nx=origLeft+dx,ny=origTop+dy;
        node.style.left=Math.max(0,nx)+'px';node.style.top=Math.max(0,ny)+'px';
      }
      function pointerUp(){
        if(!dragging) return;
        dragging=false;node.classList.remove('dragging');
        const r=node.getBoundingClientRect();
        const icons=Array.from(document.querySelectorAll('.desktop .icon')).filter(n=>n!==node);
        let swapTarget=null;
        for(const icon of icons){const rect2=icon.getBoundingClientRect();if(r.left<rect2.right && r.right>rect2.left && r.top<rect2.bottom && r.bottom>rect2.top){swapTarget=icon;break}}
        if(swapTarget){
          const id1=node.getAttribute('data-id'),id2=swapTarget.getAttribute('data-id');
          const pos1=desktopPositions[id1]||gridPositionForIndex(desktopItems.findIndex(i=>i.id===id1));
          const pos2=desktopPositions[id2]||gridPositionForIndex(desktopItems.findIndex(i=>i.id===id2));
          desktopPositions[id1]=pos2;desktopPositions[id2]=pos1;
          persistDesktopPositions();renderDesktop();
        } else {
          const snapped=snapToGrid(r.left,r.top);
          node.style.left=(snapped.x)+'px';node.style.top=(snapped.y)+'px';
          const id=node.getAttribute('data-id');desktopPositions[id]={x:snapped.x,y:snapped.y};persistDesktopPositions();
        }
        node.style.zIndex='';
        window.removeEventListener('pointermove',pointerMove);window.removeEventListener('pointerup',pointerUp);
        window.removeEventListener('touchmove',pointerMove);window.removeEventListener('touchend',pointerUp);
      }
      node.addEventListener('pointerdown',pointerDown);node.addEventListener('touchstart',pointerDown,{passive:false});
    });
  }

  function clearSelections(){document.querySelectorAll('.desktop .icon.selected').forEach(n=>n.classList.remove('selected'))}
  document.addEventListener('click',e=>{if(!e.target.closest('.desktop .icon'))clearSelections()});
  function handleDesktopAction(item){
    if(item.action==='open-notes'){winNotes.style.display='flex';bringToFront(winNotes)}
    else if(item.id==='settings' || item.title==='Settings'){openSettings()}
  }

  let ctxTargetItem=null;
  function showContextMenuFor(item,x,y){ctxTargetItem=item;const isPinned=pinnedApps.includes(item.id);ctxPin.textContent=isPinned?'Unpin from taskbar':'Pin to taskbar';ctxMenu.style.left=x+'px';ctxMenu.style.top=y+'px';ctxMenu.style.display='block';ctxMenu.setAttribute('aria-hidden','false');requestAnimationFrame(()=>{const r=ctxMenu.getBoundingClientRect();if(r.right>window.innerWidth)ctxMenu.style.left=(window.innerWidth-r.width-12)+'px';if(r.bottom>window.innerHeight)ctxMenu.style.top=(window.innerHeight-r.height-12)+'px'})}
  function hideContextMenu(){ctxMenu.style.display='none';ctxMenu.setAttribute('aria-hidden','true');ctxTargetItem=null}
  ctxOpen.addEventListener('click',()=>{if(ctxTargetItem)handleDesktopAction(ctxTargetItem);hideContextMenu()});
  ctxPin.addEventListener('click',()=>{if(!ctxTargetItem)return hideContextMenu();togglePin(ctxTargetItem.id);hideContextMenu()});
  document.addEventListener('click',e=>{if(!ctxMenu.contains(e.target))hideContextMenu()});
  window.addEventListener('keydown',e=>{if(e.key==='Escape')hideContextMenu()});

  function togglePin(id){const idx=pinnedApps.indexOf(id);if(idx===-1)pinnedApps.push(id);else pinnedApps.splice(idx,1);persistPinned();renderTaskbarPins()}
  function persistPinned(){try{localStorage.setItem(PINNED_KEY,JSON.stringify(pinnedApps))}catch(e){}}
  function renderTaskbarPins(){taskbarPinsEl.innerHTML='';pinnedApps.forEach(id=>{const item=desktopItems.find(x=>x.id===id)||defaultDesktopItems.find(x=>x.id===id);if(!item) return;const el=document.createElement('div');el.className='taskbar-pin';el.setAttribute('title',item.title);el.setAttribute('data-id',item.id);el.innerHTML=`<div style="width:28px;height:28;display:grid;place-items:center">${item.icon}</div>`;el.addEventListener('click',()=>{if(item.action==='open-notes'){winNotes.style.display='flex';bringToFront(winNotes)}else if(item.action==='open-settings'){openSettings();}});el.addEventListener('contextmenu',e=>{e.preventDefault();e.stopPropagation();showContextMenuFor(item,e.clientX,e.clientY)});taskbarPinsEl.appendChild(el)})}
  function persistDesktopPositions(){try{localStorage.setItem(DESKTOP_POS_KEY,JSON.stringify(desktopPositions))}catch(e){}}
  function focusPin(){if(pinInput){pinInput.focus();pinInput.select()}}
  function hideLogin(){if(loginScreen)loginScreen.style.display='none';document.body.classList.remove('locked');if(getComputedStyle(winNotes).display!=='none')noteTextEl.focus()}
  function showLogin(){if(loginScreen)loginScreen.style.display='flex';document.body.classList.add('locked');setTimeout(()=>focusPin(),60)}
  function checkPin(){if(!pinInput) return;const v=pinInput.value||'';if(v===REQUIRED_PIN)hideLogin();else{pinInput.value='';pinInput.placeholder='Fricking Loser';if(loginScreen&&loginScreen.animate){loginScreen.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:220,easing:'cubic-bezier(.2,.9,.2,1)'})}setTimeout(()=>{pinInput.placeholder='PIN';focusPin()},800)}}
  if(pinSubmit)pinSubmit.addEventListener('click',checkPin);
  if(pinCancel)pinCancel.addEventListener('click',()=>{if(!pinInput) return;pinInput.value='';focusPin()});
  if(pinInput){pinInput.addEventListener('keydown',e=>{if(e.key==='Enter')checkPin();else if(e.key==='Escape'){pinInput.value=''}})}
  showLogin();
  function isLocked(){return loginScreen&&getComputedStyle(loginScreen).display!=='none'}

  function openStartMenu(){if(isLocked()){focusPin();return}startMenu.style.display='block';startMenu.setAttribute('aria-hidden','false');startBtn.setAttribute('aria-expanded','true');setTimeout(()=>startSearch.focus(),60)}
  function closeStartMenu(){startMenu.style.display='none';startMenu.setAttribute('aria-hidden','true');startBtn.setAttribute('aria-expanded','false');startBtn.focus()}
  startBtn.addEventListener('click',e=>{e.stopPropagation();if(isLocked()){focusPin();return}if(startMenu.style.display==='block')closeStartMenu();else openStartMenu()});
  document.addEventListener('click',e=>{if(startMenu.style.display!=='block')return; if(!startMenu.contains(e.target)&&!startBtn.contains(e.target))closeStartMenu()});
  startMenu.addEventListener('click',e=>e.stopPropagation());
  startSearch.addEventListener('input',e=>{const q=e.target.value.trim().toLowerCase();const items=document.querySelectorAll('#startAppList .app-item');items.forEach(it=>{it.style.display=(!q||it.textContent.toLowerCase().includes(q))?'flex':'none'})});

  /* NOTES APP helpers (unchanged core) */
  function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,9)}
  function now(){return Date.now()}
  function formatTime(ts){const d=new Date(ts);return d.toLocaleString([],{hour:'2-digit',minute:'2-digit',month:'short',day:'numeric'})}
  function saveAll(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(notes))}catch(e){}}
  function loadAll(){try{const s=localStorage.getItem(STORAGE_KEY);notes=s?JSON.parse(s):[]}catch(e){notes=[]}}
  function renderList(){const q=filter.trim().toLowerCase();const list=notes.slice().filter(n=>{if(!q) return true;return(n.title||'').toLowerCase().includes(q)||(n.body||'').toLowerCase().includes(q)}).sort((a,b)=>b.updated-a.updated);noteListEl.innerHTML='';if(list.length===0){noteListEl.innerHTML='<div style="padding:14px;color:#66799a">No notes yet ‚Äî click New to create one.</div>';return}list.forEach(n=>{const item=document.createElement('div');item.className='note-item'+(n.id===selectedId?' active':'');item.setAttribute('data-id',n.id);const title=document.createElement('div');title.className='note-title';title.textContent=n.title||'Untitled';const snippet=document.createElement('div');snippet.className='note-snippet';snippet.textContent=(n.body||'').split('\n').join(' ').slice(0,120);const meta=document.createElement('div');meta.className='note-meta';meta.textContent=formatTime(n.updated);item.appendChild(title);item.appendChild(snippet);item.appendChild(meta);item.addEventListener('click',()=>{if(isLocked()){focusPin();return}selectNote(n.id)});noteListEl.appendChild(item)})}
  function selectNote(id){const n=notes.find(x=>x.id===id);if(!n) return;selectedId=id;noteTitleEl.value=n.title||'';noteTextEl.value=n.body||'';renderList();focusEditor()}
  function createNote(){if(isLocked()){focusPin();return}const id=uid();const n={id,title:'',body:'',updated:now()};notes.push(n);saveAll();selectedId=id;renderList();selectNote(id);focusTitle()}
  function deleteSelected(){if(isLocked()){focusPin();return}if(!selectedId) return alert('No note selected to delete.');const idx=notes.findIndex(n=>n.id===selectedId);if(idx===-1) return;const confirmDel=confirm('Delete this note? This action cannot be undone.');if(!confirmDel) return;notes.splice(idx,1);selectedId=notes.length?notes[0].id:null;saveAll();renderList();if(selectedId)selectNote(selectedId);else{noteTitleEl.value='';noteTextEl.value=''}}
  let saveTimer=null;
  function scheduleSave(){if(isLocked()){focusPin();return}if(!selectedId) return;if(saveTimer) clearTimeout(saveTimer);saveTimer=setTimeout(()=>{const n=notes.find(x=>x.id===selectedId);if(!n) return;n.title=noteTitleEl.value;n.body=noteTextEl.value;n.updated=now();saveAll();renderList()},450)}
  function focusEditor(){noteTextEl.focus()}
  function focusTitle(){noteTitleEl.focus();noteTitleEl.select()}
  searchInput.addEventListener('input',e=>{filter=e.target.value;renderList()});
  btnNew.addEventListener('click',createNote);
  btnDelete.addEventListener('click',deleteSelected);
  noteTitleEl.addEventListener('input',scheduleSave);
  noteTextEl.addEventListener('input',scheduleSave);
  window.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='n'){e.preventDefault();createNote()}if(e.key==='Escape'){if(startMenu.style.display==='block')closeStartMenu();else{searchInput.blur();noteTextEl.blur();noteTitleEl.blur()}}});

  function setLocked(state){locked=!!state;if(locked){editorInner.classList.add('editor-locked');noteTitleEl.readOnly=true;noteTextEl.readOnly=true;btnLock.style.opacity='0.75'}else{editorInner.classList.remove('editor-locked');noteTitleEl.readOnly=false;noteTextEl.readOnly=false;btnLock.style.opacity=''}}
  btnLock.addEventListener('click',()=>{setLocked(!locked)});

  (function makeResizable(){let resizing=false,startX=0,startY=0,startW=0,startH=0;const res=notesResizer;res.addEventListener('mousedown',ev=>{if(winNotes.classList.contains('fullscreen')) return; if(isLocked()){focusPin();return}resizing=true;startX=ev.clientX;startY=ev.clientY;const rect=winNotes.getBoundingClientRect();startW=rect.width;startH=rect.height;ev.preventDefault()});window.addEventListener('mousemove',ev=>{if(!resizing) return;const dx=ev.clientX-startX,dy=ev.clientY-startY;winNotes.style.width=Math.max(520,startW+dx)+'px';winNotes.style.height=Math.max(300,startH+dy)+'px'});window.addEventListener('mouseup',()=>resizing=false)})();

  (function makeDraggable(){const header=winNotes.querySelector('[data-drag="true"]');let dragging=false,sx=0,sy=0,ox=0,oy=0;header.addEventListener('mousedown',e=>{if(winNotes.classList.contains('fullscreen')) return; if(isLocked()){focusPin();return}dragging=true;sx=e.clientX;sy=e.clientY;const r=winNotes.getBoundingClientRect();ox=r.left;oy=r.top;header.style.cursor='grabbing'});window.addEventListener('mousemove',e=>{if(!dragging) return;const dx=e.clientX-sx,dy=e.clientY-sy;winNotes.style.left=Math.max(8,ox+dx)+'px';winNotes.style.top=Math.max(8,oy+dy)+'px'});window.addEventListener('mouseup',()=>{dragging=false;header.style.cursor='grab'})})();

  notesMin.addEventListener('click',()=>{if(isLocked()){focusPin();return}winNotes.style.display='none'});
  notesClose.addEventListener('click',()=>{if(isLocked()){focusPin();return}if(confirm('Close notes window?')) winNotes.style.display='none'});

  function toggleFullscreen(){if(isLocked()){focusPin();return}if(!winNotes.classList.contains('fullscreen')){const prev={left:winNotes.style.left||'',top:winNotes.style.top||'',width:winNotes.style.width||'',height:winNotes.style.height||'',borderRadius:winNotes.style.borderRadius||''};try{winNotes.dataset.prev=JSON.stringify(prev)}catch(e){}winNotes.classList.add('fullscreen');winNotes.style.left='';winNotes.style.top='';winNotes.style.width='';winNotes.style.height='';winNotes.style.borderRadius='0'}else{try{const prev=winNotes.dataset.prev?JSON.parse(winNotes.dataset.prev):null;if(prev){winNotes.style.left=prev.left||'';winNotes.style.top=prev.top||'';winNotes.style.width=prev.width||'';winNotes.style.height=prev.height||'';winNotes.style.borderRadius=prev.borderRadius||''}}catch(e){}winNotes.classList.remove('fullscreen')}}
  notesFull.addEventListener('click',toggleFullscreen);
  const titleBar=winNotes.querySelector('.titlebar');titleBar.addEventListener('dblclick',()=>toggleFullscreen());
  winNotes.addEventListener('mousedown',()=>bringToFront(winNotes));
  let topZ=40;function bringToFront(el){topZ+=1;el.style.zIndex=topZ}

  loadAll();
  if(notes.length>0){notes.sort((a,b)=>b.updated-a.updated);selectedId=notes[0].id;renderList();selectNote(selectedId)}else{renderList();selectedId=null;noteTitleEl.value='';noteTextEl.value=''}

  (function initDesktopState(){desktopItems=JSON.parse(JSON.stringify(defaultDesktopItems));const saved=JSON.parse(localStorage.getItem(DESKTOP_POS_KEY)||'null')||{};desktopPositions=saved;pinnedApps=JSON.parse(localStorage.getItem(PINNED_KEY)||'null')||pinnedApps||[];renderDesktop();renderTaskbarPins()})();

  function updateClock(){const d=new Date();clockEl.textContent=d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}
  updateClock();setInterval(updateClock,30000);

  tbNotes.addEventListener('click',()=>{if(isLocked()){focusPin();return}if(getComputedStyle(winNotes).display==='none'){winNotes.style.display='flex';bringToFront(winNotes)}else{winNotes.style.display='none'}});

  document.addEventListener('click',function(e){if(isLocked()){if(!loginScreen.contains(e.target)) focusPin()}},true);

  desktopInner.addEventListener('keydown',e=>{if(e.key==='Enter'){const focused=document.activeElement;if(focused&&focused.classList.contains('icon')){const id=focused.getAttribute('data-id');const item=desktopItems.find(x=>x.id===id);if(item)handleDesktopAction(item)}}});

  window.addEventListener('resize',()=>{const rect=desktopInner.getBoundingClientRect();const cols=computeGridCols();const maxRows=Math.max(1,Math.floor((rect.height-PADDING*2+GAP_Y)/(CELL_H+GAP_Y)));Object.keys(desktopPositions).forEach(id=>{let pos=desktopPositions[id];if(!pos) return;let relX=pos.x-PADDING;let relY=pos.y-PADDING;const colWidth=CELL_W+GAP_X;const rowHeight=CELL_H+GAP_Y;let col=Math.round(relX/colWidth);let row=Math.round(relY/rowHeight);col=Math.max(0,Math.min(cols-1,col));row=Math.max(0,Math.min(maxRows-1,row));desktopPositions[id]={x:PADDING+col*colWidth,y:PADDING+row*rowHeight}});persistDesktopPositions();renderDesktop()});

  /* ---------------------------
     Settings app behavior
     ---------------------------*/
  const wallpaperEl = document.querySelector('.wallpaper');

  function setWallpaper(url, persist = false){
    if(!wallpaperEl) return;
    if(!url){
      wallpaperEl.style.backgroundImage = '';
      wallpaperEl.style.backgroundColor = '#111';
      wallpaperEl.style.backgroundRepeat = '';
      wallpaperEl.style.backgroundSize = '';
      wallpaperEl.style.backgroundPosition = '';
    } else {
      // use url wrapped in url()
      wallpaperEl.style.backgroundImage = `url("${url}")`;
      wallpaperEl.style.backgroundSize = 'cover';
      wallpaperEl.style.backgroundPosition = 'center';
      wallpaperEl.style.backgroundRepeat = 'no-repeat';
    }
    // update preview too
    if(wallPreview) wallPreview.style.backgroundImage = url?`url("${url}")`:'';
    if(persist){
      try{localStorage.setItem(WALLPAPER_KEY, JSON.stringify({url}))}catch(e){}
    }
  }

  function loadWallpaperFromStorage(){
    try{
      const raw = localStorage.getItem(WALLPAPER_KEY);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(obj && obj.url){
        setWallpaper(obj.url, false);
      }
    }catch(e){}
  }

  // presets (local filenames or placeholders user likely has). Use safe sample names.
  const presets = [
    {name:'Default', url:'WALLPEPPA.jpeg'},
    {name:'Blue', url:'wall1.jpg'},
    {name:'Mountains', url:'wall2.jpg'},
    {name:'Abstract', url:'wall3.jpg'}
  ];

  function renderPresets(){
    if(!presetGrid) return;
    presetGrid.innerHTML='';
    presets.forEach(p=>{
      const el=document.createElement('div');
      el.className='preset-thumb';
      el.title = p.name;
      el.style.backgroundImage = `url("${p.url}")`;
      el.addEventListener('click',()=>{ setWallpaper(p.url, false); });
      presetGrid.appendChild(el);
    });
  }

  // wire file input
  wallFile.addEventListener('change', (ev)=>{
    const f = ev.target.files && ev.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(e){
      const dataUrl = e.target.result;
      // preview immediately
      setWallpaper(dataUrl, false);
      // store temporarily in the URL input so user can save or change
      wallUrl.value = '';
    };
    reader.readAsDataURL(f);
  });

  // apply from URL
  applyUrl.addEventListener('click', ()=>{
    const v = (wallUrl.value||'').trim();
    if(!v) return alert('Enter an image URL first.');
    // try to set it; note: cross-origin may affect real fetches but background can still reference URL
    setWallpaper(v, false);
  });

  // Save button - persist current preview as wallpaper
  saveWallpaperBtn.addEventListener('click', ()=>{
    // take whatever preview is set in wallPreview or wallpaperEl
    const style = wallpaperEl.style.backgroundImage;
    if(!style || style===''){
      // resetting
      try{localStorage.removeItem(WALLPAPER_KEY);}catch(e){}
      alert('Wallpaper reset to default.');
      loadWallpaperFromStorage();
      return;
    }
    // style looks like: url("..."), extract inside quotes
    const match = style.match(/url\(["']?(.*?)["']?\)/);
    const url = match ? match[1] : null;
    if(url){
      setWallpaper(url, true);
      alert('Wallpaper saved.');
    } else {
      alert('Could not determine preview image to save.');
    }
  });

  // Reset to default
  resetWallpaper.addEventListener('click', ()=>{
    if(confirm('Reset wallpaper to default?')){
      try{localStorage.removeItem(WALLPAPER_KEY);}catch(e){}
      // fallback to original file
      setWallpaper('WALLPEPPA.jpeg', false);
    }
  });

  // initialize settings UI
  renderPresets();
  loadWallpaperFromStorage();

  // open/close settings
  function openSettings(){
    if(isLocked()){focusPin();return}
    winSettings.style.display='flex';
    bringToFront(winSettings);
    // ensure preview matches current wallpaper
    const bg = wallpaperEl.style.backgroundImage;
    wallPreview.style.backgroundImage = bg || '';
    // put focus on URL field after a tick
    setTimeout(()=>wallUrl.focus(),60);
  }
  function closeSettings(){
    winSettings.style.display='none';
  }

  // attach Start menu item and tile to open settings
  // find the app-item node that contains "Settings"
  Array.from(startAppList.querySelectorAll('.app-item')).forEach(it=>{
    if((it.textContent||'').toLowerCase().includes('settings')){
      it.style.cursor='pointer';
      it.addEventListener('click', (e)=>{
        e.stopPropagation();
        openSettings();
        closeStartMenu();
      });
    }
  });
  if(tileSettings){
    tileSettings.addEventListener('click', (e)=>{ e.stopPropagation(); openSettings(); closeStartMenu(); });
  }

  // settings window controls
  settingsMin.addEventListener('click', ()=>{ if(isLocked()){focusPin();return} winSettings.style.display='none' });
  settingsClose.addEventListener('click', ()=>{ if(isLocked()){focusPin();return} if(confirm('Close settings?')) closeSettings(); });
  settingsFull.addEventListener('click', ()=>{ if(isLocked()){focusPin();return} if(!winSettings.classList.contains('fullscreen')){ try{winSettings.dataset.prev=JSON.stringify({left:winSettings.style.left||'',top:winSettings.style.top||'',width:winSettings.style.width||'',height:winSettings.style.height||'',borderRadius:winSettings.style.borderRadius||''})}catch(e){}winSettings.classList.add('fullscreen');winSettings.style.left='';winSettings.style.top='';winSettings.style.width='';winSettings.style.height='';winSettings.style.borderRadius='0'} else { try{const prev=winSettings.dataset.prev?JSON.parse(winSettings.dataset.prev):null;if(prev){winSettings.style.left=prev.left||'';winSettings.style.top=prev.top||'';winSettings.style.width=prev.width||'';winSettings.style.height=prev.height||'';winSettings.style.borderRadius=prev.borderRadius||''}}catch(e){}winSettings.classList.remove('fullscreen') } });

  // Make settings window draggable (reuse the draggable pattern)
  (function makeDraggableSettings(){const header=winSettings.querySelector('[data-drag="true"]');let dragging=false,sx=0,sy=0,ox=0,oy=0;header.addEventListener('mousedown',e=>{if(winSettings.classList.contains('fullscreen')) return; if(isLocked()){focusPin();return}dragging=true;sx=e.clientX;sy=e.clientY;const r=winSettings.getBoundingClientRect();ox=r.left;oy=r.top;header.style.cursor='grabbing'});window.addEventListener('mousemove',e=>{if(!dragging) return;const dx=e.clientX-sx,dy=e.clientY-sy;winSettings.style.left=Math.max(8,ox+dx)+'px';winSettings.style.top=Math.max(8,oy+dy)+'px'});window.addEventListener('mouseup',()=>{dragging=false;header.style.cursor='grab'})})();

  // Helper: clicking the Settings "Wallpaper" category scrolls or focuses the wallpaper area
  document.getElementById('settings-category-wall').addEventListener('click', ()=>{
    const el = document.getElementById('settingsMain');
    if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
  });

  /* Set simple desktop icon for Settings so users can drag/launch from desktop */
  // add to desktopItems if it doesn't exist
  (function ensureSettingsIcon(){
    const exists = desktopItems.find(i=>i.title==='Settings' || i.id==='settings');
    if(!exists){
      // use the settings.png path as the icon HTML so it shows everywhere (desktop, taskbar pins)
      const imgHtml = '<img src="settings.png" alt="Settings" style="width:36px;height:36px;object-fit:contain;border-radius:8px;display:block">';
      desktopItems.push({id:'settings', title:'Settings', icon: imgHtml, action:'open-settings'});
      renderDesktop();
    }
  })();

  // ensure the tile in start also opens settings (also handled above)

  /* Apply persisted wallpaper on load again (safety) */
  loadWallpaperFromStorage();

  /* end settings app behavior */
})();
</script>
</body>
</html>
